# 서울 청년 정책 추천 서비스 - 시스템 플로우 다이어그램

## 📊 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 (청년)                               │
│                    https://mintai09.github.io                    │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                     프론트엔드 (React)                             │
│              GitHub Pages (정적 호스팅)                            │
│  ┌──────────────┬──────────────┬──────────────┐                 │
│  │  IntroPage   │  SurveyPage  │  ResultPage  │                 │
│  │   (시작)      │   (설문)      │   (결과)      │                 │
│  └──────────────┴──────────────┴──────────────┘                 │
│                 Zustand (상태 관리)                               │
└────────────────────────────┬────────────────────────────────────┘
                             │ HTTPS
                             │ POST /recommend
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│                    백엔드 (FastAPI)                                │
│              Fly.io (seoul-youth-policies-api)                   │
│  ┌──────────────────────────────────────────────────┐           │
│  │  PolicyRecommender (추천 엔진)                     │           │
│  │  ├─ check_eligibility() - 자격 판정               │           │
│  │  ├─ calculate_total_rent() - 환산액 계산          │           │
│  │  ├─ check_income_eligibility() - 소득 판정        │           │
│  │  └─ recommend() - 최종 추천                       │           │
│  └──────────────────────────────────────────────────┘           │
│                      ▲                                           │
│                      │ 읽기                                      │
│  ┌──────────────────────────────────────────────────┐           │
│  │           rules.yaml (정책 규칙)                   │           │
│  │  - 9개 정책 정의                                   │           │
│  │  - 자격 조건, 혜택 정보                            │           │
│  └──────────────────────────────────────────────────┘           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 사용자 플로우 (User Flow)

```
시작
 │
 ▼
┌────────────────────┐
│   1. IntroPage     │
│   (인트로 화면)      │
│                    │
│  ┌──────────────┐  │
│  │ 🏠 주거       │  │
│  │ 💰 소득       │  │
│  │ 💎 자산형성   │  │
│  │ 🚇 교통       │  │
│  └──────────────┘  │
│  [시작하기] 버튼    │
└────────┬───────────┘
         │ 클릭
         ▼
┌────────────────────┐
│   2. SurveyPage    │
│   (설문 페이지)      │
│                    │
│  질문 1/10         │
│  ┌──────────────┐  │
│  │ 만 나이?      │  │
│  ├──────────────┤  │
│  │ □ 19~22세    │  │ ◄─ 카드 선택 (300ms 딜레이)
│  │ □ 23~26세    │  │
│  │ □ 27~30세    │  │
│  └──────────────┘  │
│                    │
│  [━━━━━━━━━━] 10%  │ ◄─ 진행률 표시
└────────┬───────────┘
         │ 10개 질문 반복
         │
         ▼
┌────────────────────┐
│  Zustand Store     │
│  (상태 저장)         │
│                    │
│  {                 │
│    age: 25,        │
│    income: 2500000,│
│    ...             │
│  }                 │
└────────┬───────────┘
         │ 설문 완료
         ▼
┌────────────────────┐
│  API 호출          │
│  POST /recommend   │
│                    │
│  ┌──────────────┐  │
│  │  로딩 스피너  │  │ ◄─ "정책을 분석하고 있어요..."
│  └──────────────┘  │
└────────┬───────────┘
         │ 응답 수신
         ▼
┌────────────────────┐
│   3. ResultPage    │
│   (추천 결과)        │
│                    │
│  총 3개 정책 적합   │
│                    │
│  ┌──────────────┐  │
│  │ 🏠 청년 월세  │  │
│  │ 월 20만원     │  │ ◄─ 정책 카드
│  │ [신청하기]    │  │
│  └──────────────┘  │
│                    │
│  ┌──────────────┐  │
│  │ 🚇 K-Pass    │  │
│  │ 월 2만원 환급 │  │
│  │ [신청하기]    │  │
│  └──────────────┘  │
│                    │
│  [처음으로]        │
└────────────────────┘
```

---

## 🧠 추천 알고리즘 플로우

```
사용자 프로필 입력
 │
 ▼
┌─────────────────────────────────────────┐
│  1단계: 기본 자격 확인                    │
│                                         │
│  ┌─────────────┐                        │
│  │ 서울 거주?   │ ──NO──> ❌ 제외        │
│  └──────┬──────┘                        │
│         YES                             │
│         ▼                               │
│  ┌─────────────┐                        │
│  │ 연령 범위?   │ ──NO──> ❌ 제외        │
│  └──────┬──────┘                        │
│         YES                             │
└─────────┼───────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────┐
│  2단계: 소득 기준 판정                    │
│                                         │
│  ┌────────────────────────┐             │
│  │ 2026년 중위소득 조회    │             │
│  │ 1인 가구: 2,564,238원  │             │
│  └────────┬───────────────┘             │
│           ▼                             │
│  ┌────────────────────────┐             │
│  │ 소득 기준 계산          │             │
│  │ 150% → 3,846,357원     │             │
│  └────────┬───────────────┘             │
│           ▼                             │
│  ┌────────────────────────┐             │
│  │ 사용자 소득 비교        │             │
│  │ 2,500,000 < 3,846,357? │ ──YES──>   │
│  └────────────────────────┘             │
└─────────┼───────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────┐
│  3단계: 정책별 세부 조건 확인             │
│                                         │
│  🏠 주거 정책                            │
│  ┌────────────────────────┐             │
│  │ 무주택? ────YES──>      │             │
│  │ 독립 거주? ──YES──>     │             │
│  │ 보증금 ≤ 8천만? ─YES──> │             │
│  │ 월세 환산액 계산:       │             │
│  │  = 50만 + (3천만×5%÷12)│             │
│  │  = 62.5만 ≤ 93만? ✓    │             │
│  └────────┬───────────────┘             │
│           │                             │
│  💰 소득 정책                            │
│  ┌────────────────────────┐             │
│  │ 미취업? ──NO──> ❌       │             │
│  │ 학생? ────NO──> ✓       │             │
│  └────────┬───────────────┘             │
│           │                             │
│  🚇 교통 정책                            │
│  ┌────────────────────────┐             │
│  │ 월 이용 44회 이상? ✓    │             │
│  │ K-Pass vs 기후동행      │             │
│  │ 월 교통비 계산:         │             │
│  │  = 44 × 1,500          │             │
│  │  = 66,000원            │             │
│  │ < 77,500원?            │             │
│  │ → K-Pass 추천 ✓        │             │
│  └────────┬───────────────┘             │
└───────────┼─────────────────────────────┘
            │
            ▼
┌─────────────────────────────────────────┐
│  4단계: 중복 지원 확인                    │
│                                         │
│  ┌────────────────────────┐             │
│  │ 과거 수혜 이력 확인     │             │
│  │ hasReceivedSupport:    │             │
│  │  ['YOUTH_RENT_ONETIME']│             │
│  └────────┬───────────────┘             │
│           ▼                             │
│  ┌────────────────────────┐             │
│  │ 제한 정책 필터링        │             │
│  │ YOUTH_RENT_SUBSIDY ✓   │             │
│  │ (중복 아님)             │             │
│  └────────────────────────┘             │
└─────────┼───────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────┐
│  5단계: 결과 생성                         │
│                                         │
│  ┌────────────────────────┐             │
│  │ 매칭된 정책 수집        │             │
│  │ ├─ 청년 월세 지원 ✓    │             │
│  │ ├─ K-Pass ✓            │             │
│  │ └─ 희망두배 통장 ✓     │             │
│  └────────┬───────────────┘             │
│           ▼                             │
│  ┌────────────────────────┐             │
│  │ 추천 이유 생성          │             │
│  │ "보증금·소득 조건 충족  │             │
│  │  + 독립 거주 중"        │             │
│  └────────┬───────────────┘             │
│           ▼                             │
│  ┌────────────────────────┐             │
│  │ 절감액 계산             │             │
│  │ 월세: 20만 × 12 = 240만 │             │
│  │ 교통: 2만 × 12 = 24만   │             │
│  │ 합계: 연 264만원        │             │
│  └────────┬───────────────┘             │
└───────────┼─────────────────────────────┘
            │
            ▼
       JSON 응답 반환
```

---

## 🔧 배포 플로우

```
개발자
 │
 │ 코드 작성
 ▼
┌─────────────────────┐
│   로컬 개발 환경     │
│                     │
│  Frontend:          │
│  localhost:3001     │
│                     │
│  Backend:           │
│  localhost:8000     │
└──────────┬──────────┘
           │ git push
           ▼
┌─────────────────────────────────────────┐
│           GitHub Repository             │
│       mintai09/seoul-youth-policies     │
└────┬──────────────────────┬─────────────┘
     │                      │
     │ 백엔드 변경           │ 프론트엔드 변경
     ▼                      ▼
┌──────────────┐      ┌──────────────────┐
│   수동 배포   │      │  GitHub Actions  │
│   (Fly.io)   │      │   자동 배포      │
│              │      │                  │
│ $ flyctl     │      │  1. npm ci       │
│   deploy     │      │  2. npm build    │
│              │      │  3. deploy       │
└──────┬───────┘      └────────┬─────────┘
       │                       │
       ▼                       ▼
┌──────────────┐      ┌──────────────────┐
│   Fly.io     │      │  GitHub Pages    │
│   (백엔드)    │      │   (프론트엔드)    │
│              │      │                  │
│ Docker       │      │ 정적 파일        │
│ FastAPI      │      │ React 빌드       │
│              │      │                  │
│ 🌐 URL:      │      │ 🌐 URL:          │
│ *.fly.dev    │      │ *.github.io      │
└──────────────┘      └──────────────────┘
       ▲                       ▲
       │                       │
       │                       │
       └───────────┬───────────┘
                   │
                   ▼
              ┌─────────┐
              │  사용자  │
              └─────────┘
```

---

## 📡 API 통신 플로우

```
프론트엔드                      백엔드
(React)                      (FastAPI)
    │                            │
    │ POST /recommend            │
    │ Content-Type: JSON         │
    ├───────────────────────────>│
    │                            │
    │ {                          │
    │   age: 25,                 │  1. Pydantic 검증
    │   isSeoulResident: true,   │     ├─ 타입 체크
    │   monthlyIncome: 2500000,  │     └─ 필수 필드 확인
    │   ...                      │
    │ }                          │
    │                            ├─> 2. PolicyRecommender 실행
    │                            │      │
    │                            │      ├─ rules.yaml 로드
    │                            │      │
    │                            │      ├─ 9개 정책 순회
    │                            │      │   ├─ check_eligibility()
    │                            │      │   ├─ 소득 계산
    │                            │      │   └─ 환산액 계산
    │                            │      │
    │                            │      └─ 매칭 결과 생성
    │                            │
    │                            │  3. JSON 응답 생성
    │                            │
    │ 200 OK                     │
    │<───────────────────────────┤
    │                            │
    │ {                          │
    │   eligible_count: 3,       │
    │   recommendations: [       │
    │     {                      │
    │       policy_name: "...",  │
    │       tip: "...",          │
    │       estimated_savings: "│
    │     }                      │
    │   ]                        │
    │ }                          │
    │                            │
    ▼                            ▼
ResultPage 렌더링            로그 기록
```

---

## 🔄 Claude 기반 정책 업데이트 플로우 (향후 구현)

```
┌─────────────────────┐
│  서울시 청년포털     │
│  새 정책 공고       │
└──────────┬──────────┘
           │
           │ RSS/웹훅
           ▼
┌─────────────────────────────────────┐
│      자동 모니터링 시스템            │
│  (GitHub Actions - 매일 실행)       │
│                                     │
│  1. 공고문 크롤링                   │
│  2. 신규 정책 감지                  │
└──────────┬──────────────────────────┘
           │
           │ 새 정책 발견
           ▼
┌─────────────────────────────────────┐
│       Claude API 호출               │
│                                     │
│  프롬프트:                          │
│  "다음 공고문을 분석하여            │
│   YAML 형식으로 구조화하세요"       │
│                                     │
│  [공고문 전문]                      │
│  ...                                │
└──────────┬──────────────────────────┘
           │
           ▼
┌─────────────────────────────────────┐
│     Claude 응답 (YAML 생성)         │
│                                     │
│  - id: NEW_POLICY_2026             │
│    name: 신규 청년 정책             │
│    eligibility:                    │
│      age_range: [19, 34]           │
│      income_threshold_percent: 120 │
│    benefit: "월 30만원 지원"        │
└──────────┬──────────────────────────┘
           │
           │ 자동 검증
           ▼
┌─────────────────────────────────────┐
│       YAML 유효성 검증               │
│                                     │
│  ✓ 필수 필드 확인                   │
│  ✓ 타입 체크                        │
│  ✓ 기존 정책 중복 확인              │
└──────────┬──────────────────────────┘
           │
           │ 검증 통과
           ▼
┌─────────────────────────────────────┐
│      GitHub PR 자동 생성             │
│                                     │
│  Title: "feat: 신규 청년 정책 추가" │
│  Body:                              │
│  - 정책명: ...                      │
│  - 대상: ...                        │
│  - 혜택: ...                        │
│                                     │
│  Files Changed:                     │
│  └─ rules.yaml (+10 -0)            │
└──────────┬──────────────────────────┘
           │
           │ 개발자 리뷰
           ▼
┌─────────────────────────────────────┐
│         개발자 승인                  │
│                                     │
│  ✓ 내용 확인                        │
│  ✓ 테스트 실행                      │
│  ✓ PR 병합                          │
└──────────┬──────────────────────────┘
           │
           │ main 브랜치 병합
           ▼
┌─────────────────────────────────────┐
│        자동 배포 트리거              │
│                                     │
│  Backend (Fly.io)    ─┐             │
│  Frontend (GH Pages) ─┤ 동시 배포   │
└───────────────────────┴─────────────┘
           │
           ▼
      🎉 정책 추가 완료
```

---

## 📊 데이터 흐름 (Data Flow)

```
┌─────────────────────┐
│   rules.yaml        │
│   (정책 정의)        │
│                     │
│  - 9개 정책         │
│  - 자격 조건        │
│  - 혜택 정보        │
└──────────┬──────────┘
           │ 읽기 (앱 시작 시)
           ▼
┌─────────────────────┐
│  PolicyRecommender  │
│  (메모리에 로드)     │
│                     │
│  policy_db = [...]  │
└──────────┬──────────┘
           │
           │ 사용자 요청마다
           ▼
┌─────────────────────────────────────┐
│         추천 알고리즘               │
│                                     │
│  for policy in policy_db:           │
│    if is_eligible(user, policy):    │
│      recommendations.append(policy) │
└──────────┬──────────────────────────┘
           │
           ▼
      JSON 응답
```

---

## 🎨 UI 컴포넌트 구조

```
App.tsx
 │
 ├─ Router (basename: /seoul-youth-policies)
 │   │
 │   ├─ Route: /
 │   │   └─ IntroPage
 │   │       ├─ 제목
 │   │       ├─ 소제목
 │   │       ├─ 카테고리 카드 (4개)
 │   │       │   ├─ 🏠 주거
 │   │       │   ├─ 💰 소득
 │   │       │   ├─ 💎 자산형성
 │   │       │   └─ 🚇 교통
 │   │       ├─ [시작하기] 버튼
 │   │       └─ 하단 안내 (3분 소요 등)
 │   │
 │   ├─ Route: /survey
 │   │   └─ SurveyPage
 │   │       ├─ 진행률 바
 │   │       ├─ 헤더
 │   │       │   ├─ [← 이전] 버튼
 │   │       │   └─ 페이지 카운터 (1/10)
 │   │       └─ 질문 영역
 │   │           ├─ 질문 텍스트
 │   │           └─ 선택지 카드들
 │   │               └─ [카드 버튼] × N개
 │   │
 │   └─ Route: /result
 │       └─ ResultPage
 │           ├─ 헤더
 │           │   ├─ "추천 결과"
 │           │   └─ "총 N개 정책 적합"
 │           ├─ 정책 카드 리스트
 │           │   └─ PolicyCard × N
 │           │       ├─ 카테고리 배지
 │           │       ├─ 정책명
 │           │       ├─ 설명
 │           │       ├─ 추천 이유 (파란 박스)
 │           │       ├─ 예상 혜택 금액
 │           │       └─ [신청하기] 버튼
 │           └─ [처음으로] 버튼
 │
 └─ Zustand Store
     └─ userProfile
         ├─ age
         ├─ isSeoulResident
         ├─ monthlyIncome
         └─ ... (10개 필드)
```

---

## 🔐 보안 플로우

```
사용자 입력
 │
 ▼
┌─────────────────────┐
│  프론트엔드 검증     │
│                     │
│  ✓ 타입 체크        │
│  ✓ 범위 체크        │
└──────────┬──────────┘
           │
           │ HTTPS
           ▼
┌─────────────────────┐
│  백엔드 검증         │
│  (Pydantic)         │
│                     │
│  ✓ 타입 체크        │
│  ✓ 필수 필드        │
│  ✓ SQL Injection 방지│
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  비즈니스 로직       │
│                     │
│  (개인정보 미저장)   │
└──────────┬──────────┘
           │
           ▼
       응답 반환
```

---

**이 다이어그램들을 PNG/SVG로 변환하려면**:
- Mermaid Live Editor: https://mermaid.live
- Draw.io: https://app.diagrams.net
- Lucidchart: https://www.lucidchart.com

**작성일**: 2026년 2월 10일
**프로젝트**: 서울 청년 정책 맞춤 추천 서비스
